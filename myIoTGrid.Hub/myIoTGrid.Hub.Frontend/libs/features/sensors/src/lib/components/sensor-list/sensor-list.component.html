<div class="sensor-list-page">
  @if (!initialLoadDone) {
    <myiotgrid-loading-spinner message="Sensoren werden geladen..."></myiotgrid-loading-spinner>
  } @else if (totalRecords === 0) {
    <myiotgrid-empty-state
      icon="sensors"
      title="Keine Sensoren"
      message="Es wurden noch keine Sensoren angelegt."
      actionLabel="Neuer Sensor"
      (actionClicked)="onCreate()">
    </myiotgrid-empty-state>
  } @else {
    <header class="page-header">
      <div class="header-content">
        <h1 class="page-title">Sensoren</h1>
        <p class="page-subtitle">Sensor-Instanzen mit Kalibrierung und Pin-Konfiguration verwalten</p>
      </div>
    </header>
    <myiotgrid-generic-table
        [data]="sensors"
        [totalRecords]="totalRecords"
        [loading]="loading"
        [columns]="columns"
        dataKey="id"
        [stateKey]="'sensors-table'"
        [globalFilterFields]="['id','name','code','category','serialNumber']"
        createLabel="Neuer Sensor"
        [useGlobalSearch]="false"
        detailTitle="Sensor"
        (lazyLoad)="loadSensorsLazy($event)"
        (edit)="onEdit($any($event))"
        (remove)="deleteSensor($any($event))"
        (create)="onCreate()"
        [detailMode]="'route'"
        detailRouteBase="/sensors"
        [showFilter]="true"
        filterTitle="Sensoren filtern"
        (filterChange)="onFilterChange($event)">

        <!-- Filter Template -->
        <ng-template #filterTemplate let-filters>
            <div class="filter-fields">
                <!-- Kategorie -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Kategorie</mat-label>
                    <mat-select [ngModel]="filters['category']"
                                (ngModelChange)="filters['category'] = $event">
                        <mat-option [value]="''">Alle</mat-option>
                        @for (category of sensorCategories; track category) {
                            <mat-option [value]="category">{{ getCategoryLabel(category) }}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>

                <!-- Status -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Status</mat-label>
                    <mat-select [ngModel]="filters['isActive']"
                                (ngModelChange)="filters['isActive'] = $event">
                        @for (status of statusOptions; track status.value) {
                            <mat-option [value]="status.value">{{ status.label }}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>
        </ng-template>

        <!-- Icon Column Template -->
        <ng-template [myiotgridColumnTemplate]="'icon'" let-row>
            <div class="sensor-icon" [style.background-color]="getSensorColor(row)">
                <mat-icon>{{ getSensorIcon(row) }}</mat-icon>
            </div>
        </ng-template>

        <!-- Category Column Template -->
        <ng-template [myiotgridColumnTemplate]="'category'" let-row>
            <span>{{ getCategoryLabel(row.category) }}</span>
        </ng-template>

        <!-- Protocol Column Template -->
        <ng-template [myiotgridColumnTemplate]="'protocol'" let-row>
            <span>{{ getProtocolLabel(row.protocol) }}</span>
        </ng-template>

        <!-- Status Column Template -->
        <ng-template [myiotgridColumnTemplate]="'isActive'" let-row>
            <mat-chip [class.active]="row.isActive" [class.inactive]="!row.isActive">
                <mat-icon matChipAvatar>{{ row.isActive ? 'check_circle' : 'cancel' }}</mat-icon>
                {{ row.isActive ? 'Aktiv' : 'Inaktiv' }}
            </mat-chip>
        </ng-template>

    </myiotgrid-generic-table>
  }
</div>
