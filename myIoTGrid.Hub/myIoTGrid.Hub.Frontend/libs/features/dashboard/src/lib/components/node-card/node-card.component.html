<mat-card class="node-card" [class.offline]="!node().isOnline" [routerLink]="['/nodes', node().id]">
  <mat-card-header>
    <mat-icon mat-card-avatar class="node-icon">router</mat-icon>
    <mat-card-title>{{ locationName() }}</mat-card-title>
    <mat-card-subtitle>{{ node().name }}</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    @if (primaryReading()) {
      <div class="primary-reading">
        <mat-icon class="reading-icon" [style.color]="getColorForReading(primaryReading()!)">
          {{ getIconForReading(primaryReading()!) }}
        </mat-icon>
        <div class="reading-value">
          <span class="value">{{ primaryReading()!.value | sensorUnit:primaryReading()!.unit }}</span>
          <span class="type-name">{{ primaryReading()!.displayName }}</span>
        </div>
      </div>

      @if (secondaryReadings().length > 0) {
        <div class="secondary-readings">
          @for (reading of secondaryReadings(); track reading.measurementType) {
            <div class="secondary-reading" [matTooltip]="reading.displayName">
              <mat-icon [style.color]="getColorForReading(reading)">
                {{ getIconForReading(reading) }}
              </mat-icon>
              <span class="value">{{ reading.value | sensorUnit:reading.unit }}</span>
            </div>
          }
        </div>
      }

      <div class="reading-meta">
        <span class="timestamp" [matTooltip]="primaryReading()!.timestamp">
          {{ primaryReading()!.timestamp | relativeTime }}
        </span>
      </div>
    } @else {
      <div class="no-data">
        <mat-icon>sensors_off</mat-icon>
        <span>Keine Messwerte</span>
      </div>
    }
  </mat-card-content>

  <mat-card-footer>
    <div class="status-row">
      <mat-chip-set>
        <mat-chip [class.online]="node().isOnline" [class.offline]="!node().isOnline">
          <mat-icon matChipAvatar>{{ node().isOnline ? 'check_circle' : 'cancel' }}</mat-icon>
          {{ node().isOnline ? 'Online' : 'Offline' }}
        </mat-chip>
      </mat-chip-set>

      <div class="node-info">
        <span class="protocol" [matTooltip]="protocolLabel()">
          <mat-icon>{{ protocolIcon() }}</mat-icon>
        </span>
        <span class="sensor-count" [matTooltip]="sensorCount() + ' Sensoren'">
          <mat-icon>memory</mat-icon>
          {{ sensorCount() }}
        </span>
      </div>
    </div>
  </mat-card-footer>
</mat-card>
