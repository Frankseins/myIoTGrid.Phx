<mat-card class="sensor-widget" [class.hero]="isHero" [class.offline]="!widget.isOnline" (click)="onWidgetClick()" role="button" tabindex="0">
  <div class="widget-header">
    <mat-icon class="header-icon" [style.color]="widget.isOnline ? widget.color : '#9e9e9e'">{{ getLocationIcon() }}</mat-icon>
    <div class="header-text">
      <span class="measurement-type">{{ getMeasurementLabel() }}</span>
      <span class="sensor-name">{{ widget.sensorName }}</span>
    </div>
    @if (!widget.isOnline) {
      <div class="offline-badge">
        <mat-icon>cloud_off</mat-icon>
        <span>Offline</span>
      </div>
    }
  </div>

  <div class="widget-body">
    <div class="value-section">
      @if (widget.currentValue !== null && widget.currentValue !== undefined) {
        <span class="value" [class.offline-value]="!widget.isOnline">{{ formattedValue() }}</span>
        <span class="unit">{{ widget.unit }}</span>
      } @else {
        <span class="value offline-value">--</span>
        <span class="unit">{{ widget.unit }}</span>
      }
    </div>

    <div class="sparkline-section">
      @if (widget.dataPoints && widget.dataPoints.length > 0) {
        <myiotgrid-sparkline-chart
          [series]="sparklineSeries()"
          [height]="sparklineHeight()"
        />
      } @else {
        <div class="no-data-placeholder">
          <span>Keine Daten</span>
        </div>
      }
    </div>
  </div>

  <div class="widget-footer">
    <div class="widget-minmax">
      @if (widget.minMax) {
        <div class="minmax-item">
          <span class="minmax-label">Min</span>
          <span class="minmax-value">{{ widget.minMax.minValue | number:'1.1-1' }}{{ widget.unit }}</span>
          <span class="minmax-time">{{ widget.minMax.minTimestamp | date:'HH:mm' }}</span>
        </div>
        <div class="minmax-item">
          <span class="minmax-label">Max</span>
          <span class="minmax-value">{{ widget.minMax.maxValue | number:'1.1-1' }}{{ widget.unit }}</span>
          <span class="minmax-time">{{ widget.minMax.maxTimestamp | date:'HH:mm' }}</span>
        </div>
      } @else {
        <div class="minmax-item">
          <span class="minmax-label">Min</span>
          <span class="minmax-value">--</span>
        </div>
        <div class="minmax-item">
          <span class="minmax-label">Max</span>
          <span class="minmax-value">--</span>
        </div>
      }
    </div>
    <div class="footer-right">
      <div class="location-info">
        <mat-icon>location_on</mat-icon>
        <span>{{ widget.locationName }}</span>
      </div>
      <div class="last-update">
        <mat-icon>schedule</mat-icon>
        @if (widget.lastUpdate) {
          <span>{{ widget.lastUpdate | date:'dd.MM. HH:mm' }}</span>
        } @else {
          <span>--</span>
        }
      </div>
    </div>
  </div>
</mat-card>
