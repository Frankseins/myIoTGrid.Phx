<div class="readings-table-container">
  <div class="table-header">
    <h3>Messwerte</h3>
    <button mat-stroked-button (click)="onExportClick()" [disabled]="loading || !data?.items?.length">
      <mat-icon>download</mat-icon>
      CSV Export
    </button>
  </div>

  @if (loading) {
    <div class="loading-overlay">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }

  @if (data?.items?.length) {
    <table mat-table [dataSource]="data!.items" class="readings-table">
      <!-- Timestamp Column -->
      <ng-container matColumnDef="timestamp">
        <th mat-header-cell *matHeaderCellDef>Zeitpunkt</th>
        <td mat-cell *matCellDef="let reading">
          {{ reading.timestamp | date:'dd.MM.yyyy HH:mm:ss' }}
        </td>
      </ng-container>

      <!-- Value Column -->
      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef>Wert</th>
        <td mat-cell *matCellDef="let reading">
          <strong>{{ reading.value | number:'1.2-2' }}</strong> {{ unit }}
        </td>
      </ng-container>

      <!-- Trend Column -->
      <ng-container matColumnDef="trend">
        <th mat-header-cell *matHeaderCellDef>Trend</th>
        <td mat-cell *matCellDef="let reading">
          <mat-icon
            class="trend-icon"
            [style.color]="getTrendColor(reading.trendDirection)"
          >
            {{ getTrendIcon(reading.trendDirection) }}
          </mat-icon>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator
      [length]="data!.totalCount"
      [pageSize]="data!.pageSize"
      [pageIndex]="data!.page - 1"
      [pageSizeOptions]="[10, 20, 50, 100]"
      (page)="onPageChange($event)"
      showFirstLastButtons
    ></mat-paginator>
  } @else if (!loading) {
    <div class="empty-state">
      <mat-icon>show_chart</mat-icon>
      <p>Keine Messwerte vorhanden</p>
    </div>
  }
</div>
