; PlatformIO Project Configuration File
; myIoTGrid.Sensor - Grid.Sensor Firmware
;
; Build targets:
;   pio run -e esp32          -> ESP32 Hardware (Real sensors)
;   pio run -e esp32_simulate -> ESP32 Hardware (Simulated sensors)
;   pio run -e native         -> Native/Docker (Simulated sensors)

[platformio]
default_envs = native
src_dir = src
include_dir = include
lib_dir = lib
test_dir = test

[env]
framework = arduino
lib_deps =
    bblanchon/ArduinoJson@^7.2.1
build_flags =
    -std=gnu++17
    -DFIRMWARE_VERSION=\"1.0.0\"
monitor_speed = 115200

; ============================================
; ESP32 - Real Hardware with Real Sensors
; ============================================
[env:esp32]
platform = espressif32
board = esp32dev
build_flags =
    ${env.build_flags}
    -DPLATFORM_ESP32
    -DSIMULATE_SENSORS=0
    -DHARDWARE_TYPE=\"ESP32\"
lib_deps =
    ${env.lib_deps}
lib_extra_dirs =
    lib/hal_esp32

; ============================================
; ESP32 - Real Hardware with Simulated Sensors
; ============================================
[env:esp32_simulate]
platform = espressif32
board = esp32dev
build_flags =
    ${env.build_flags}
    -DPLATFORM_ESP32
    -DSIMULATE_SENSORS=1
    -DHARDWARE_TYPE=\"ESP32-SIM\"
lib_deps =
    ${env.lib_deps}
lib_extra_dirs =
    lib/hal_esp32

; ============================================
; Native - Linux/Docker Simulator
; ============================================
[env:native]
platform = native
framework =
build_flags =
    -std=gnu++17
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DPLATFORM_NATIVE
    -DSIMULATE_SENSORS=1
    -DHARDWARE_TYPE=\"SIM\"
    -I include
    -lpthread
    -lcurl
    -luuid
lib_deps =
    bblanchon/ArduinoJson@^7.2.1
lib_extra_dirs =
    lib/hal_native
test_build_src = yes

; ============================================
; Test Environment
; ============================================
[env:native_test]
platform = native
framework =
build_flags =
    -std=gnu++17
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DPLATFORM_NATIVE
    -DSIMULATE_SENSORS=1
    -DHARDWARE_TYPE=\"SIM\"
    -DUNIT_TEST
    -I include
    -lpthread
    -lcurl
    -luuid
lib_deps =
    bblanchon/ArduinoJson@^7.2.1
    throwtheswitch/Unity@^2.6.0
lib_extra_dirs =
    lib/hal_native
test_build_src = yes
