# ChirpStack Configuration for myIoTGrid.Gateway.LoRaWAN
# EU868 Region Configuration
# Stand: 10.12.2025

# ============================================
# Logging
# ============================================
[logging]
  level = "info"

# ============================================
# PostgreSQL Database
# ============================================
[postgresql]
  dsn = "postgres://chirpstack:chirpstack@postgres/chirpstack?sslmode=disable"
  max_open_connections = 10
  min_idle_connections = 0

# ============================================
# Redis
# ============================================
[redis]
  servers = ["redis://redis:6379"]
  tls_enabled = false
  cluster = false

# ============================================
# Network Configuration
# ============================================
[network]
  net_id = "000000"
  enabled_regions = ["eu868"]

# ============================================
# API Configuration
# ============================================
[api]
  bind = "0.0.0.0:8080"
  secret = "myiotgrid-chirpstack-secret-2025-hackathon"

# ============================================
# Gateway Configuration
# ============================================
[gateway]
  allow_unknown_gateways = true

# ============================================
# Integration (MQTT)
# ============================================
[integration]
  enabled = ["mqtt"]

  [integration.mqtt]
    server = "tcp://mosquitto:1883/"
    json = true
    event_topic = "application/{{application_id}}/device/{{dev_eui}}/event/{{event}}"
    command_topic = "application/{{application_id}}/device/{{dev_eui}}/command/{{command}}"
    qos = 0
    clean_session = false
    client_id = "chirpstack"

# ============================================
# Monitoring (Prometheus)
# ============================================
[monitoring]
  bind = "0.0.0.0:8070"

# ============================================
# Regions Configuration (Array Format for ChirpStack 4)
# ============================================
[[regions]]
  name = "eu868"
  common_name = "EU868"

  [regions.gateway]
    force_gws_private = false

    [regions.gateway.backend]
      enabled = "mqtt"

      [regions.gateway.backend.mqtt]
        event_topic = "eu868/gateway/{{ gateway_id }}/event/{{ event }}"
        command_topic = "eu868/gateway/{{ gateway_id }}/command/{{ command }}"
        server = "tcp://mosquitto:1883/"
        qos = 0
        clean_session = false
        client_id = "chirpstack-eu868-gw"

  [regions.network]
    installation_margin = 10
    rx1_delay = 1
    rx1_dr_offset = 0
    rx2_dr = 0
    rx2_frequency = 869525000
    downlink_tx_power = -1
    adr_disabled = false
    min_dr = 0
    max_dr = 5
